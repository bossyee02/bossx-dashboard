<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard BossX</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ===== VARIABEL GLOBAL ===== */
    :root {
      --gap: 16px;
      --radius: 12px;
      --color-primary: #6a0dad;
      --color-accent: #FFD700;
      --sidebar-width: 250px;
      --sidebar-collapsed: 60px;
      --bg-from: #6a0dad;
      --bg-to: #ff69b4;
      --text-color: var(--color-accent);
      --card-bg: rgba(0,0,0,0.3);
      --card-border: var(--color-accent);
      --table-border: var(--color-accent);
    }
    [data-theme="dark"] {
      --bg-from: #111;
      --bg-to: #000;
      --text-color: #EEE;
      --card-bg: rgba(255,255,255,0.08);
      --card-border: #555;
      --table-border: #777;
    }
    /* Layout, sidebar, card, table dll tetap seperti versi kamu */
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, var(--bg-from), var(--bg-to)); color: var(--text-color); display: flex; min-height: 100vh; }
    .container { display: grid; grid-template-columns: var(--sidebar-width) 1fr; width: 100%; }
    .content { display: flex; flex-direction: column; width: 100%; }
    main { flex: 1; padding: var(--gap); max-width: 1200px; margin: auto; display: flex; gap: var(--gap); flex-wrap: wrap; }
    .card { background: var(--card-bg); padding: var(--gap); border-radius: var(--radius); border: 1px solid var(--card-border); }
    .saldo-value { font-size: 1.4rem; font-weight: bold; margin-bottom: 8px; }
  </style>
</head>
<body data-theme="light">
  <div class="container">
    <!-- Sidebar & Header tetap sama dengan file kamu -->
    <div class="content">
      <header>
        <div id="realTimeClock">Loadingâ€¦</div>
        <button id="themeToggle" class="btn">ðŸŒ™</button>
      </header>
      <main>
        <div class="left-column">
          <div class="card">
            <h2>Validasi Running</h2>
            <div class="saldo-value" id="mining">0.000000000 BossX</div>
            <div id="stopCountdown">Belum berjalan</div>
            <button class="btn" id="onBtn">ON</button>
          </div>
          <div class="card">
            <h2>Reward Validasi</h2>
            <div class="saldo-value" id="balance">0.000000000 BossX</div>
            <div id="countdown">Auto-claim: 60s</div>
            <button class="btn" id="convertBtn">Convert to USDT</button>
          </div>
        </div>
        <div class="right-column">
          <div class="card">
            <h2>History Validasi</h2>
            <table>
              <thead><tr><th>Hari</th><th>Tanggal</th><th>Jam</th><th>BossX</th><th>Status</th></tr></thead>
              <tbody id="history"></tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  </div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // Clock realtime
    setInterval(() => {
      const d = new Date();
      document.getElementById("realTimeClock").textContent = d.toLocaleString("id-ID");
    }, 1000);

    // Variabel
    let isMiningActive = false;
    let rewardPerSecond = 0;
    let mining = 0;
    let balance = parseFloat(localStorage.getItem("balance") || 0);
    let usdtBalance = parseFloat(localStorage.getItem("usdtBalance") || 0);
    let contractEndTime = parseInt(localStorage.getItem("contractEndTime") || 0);
    let lastUpdateTime = parseInt(localStorage.getItem("lastUpdateTime") || Date.now());

    const monthlyYieldRate = 0.10;
    const contractSeconds = 31 * 24 * 60 * 60;
    const bossXtoUSDT = 1;

    const miningLabel = document.getElementById("mining");
    const balanceLabel = document.getElementById("balance");
    const countdownLabel = document.getElementById("countdown");
    const historyBody = document.getElementById("history");

    balanceLabel.textContent = balance.toFixed(9) + " BossX";

    // Hitung reward missed saat offline / tab ditutup
    function syncRewards() {
      const now = Date.now();
      if (isMiningActive && lastUpdateTime) {
        const elapsed = Math.floor((now - lastUpdateTime)/1000);
        const reward = elapsed * rewardPerSecond;
        if (reward > 0) {
          balance += reward;
          balanceLabel.textContent = balance.toFixed(9) + " BossX";
        }
      }
      lastUpdateTime = now;
      localStorage.setItem("lastUpdateTime", lastUpdateTime);
      localStorage.setItem("balance", balance);
    }

    setInterval(syncRewards, 1000);

    // Tombol ON
    document.getElementById("onBtn").addEventListener("click", () => {
      if (isMiningActive) return;
      isMiningActive = true;
      rewardPerSecond = (50 * monthlyYieldRate) / contractSeconds; // contoh fixed 50 BossX aktivasi
      lastUpdateTime = Date.now();
      localStorage.setItem("lastUpdateTime", lastUpdateTime);
      localStorage.setItem("contractEndTime", Date.now() + contractSeconds*1000);
    });

    // Convert
    document.getElementById("convertBtn").addEventListener("click", () => {
      if (balance < 1) return alert("Minimal convert adalah 1 BossX");
      const usdt = balance * bossXtoUSDT;
      usdtBalance += usdt;
      localStorage.setItem("usdtBalance", usdtBalance);
      balance = 0;
      localStorage.setItem("balance", balance);
      balanceLabel.textContent = "0.000000000 BossX";
    });
  });
</script>
</body>
</html>
